<html>
    <head>
        <title>Tfs Rest Api</title>
        <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    </head>
    <body>
        <div id="options"></div>        
        <h3 id="title"></h3>
        <pre id="result"></pre>   
        <script>
            var print = function (title, json){
                var text = JSON.stringify(json, null, 4);
                $("#result").text(text);                    
                $("#title").text(title);
            };
            
            print("Loading...", {});
            
            var getAuth = function (){
                // Alternate credentials
                var user = {
                    password: "user",
                    username: "pass"
                };
                return { "Authorization": "Basic " + btoa(user.username + ":" + user.password) };
            };
            
            var urlBase = 'https://fabrikam.visualstudio.com/defaultcollection/';
            var apiVersion = 'api-version=1.0';
            var url = urlBase + "_apis/projects?" + apiVersion;
            var urlWorkItems = '_apis/wit/workitems/$Task?' + apiVersion;
            
            // Document Ready.            
            $(function(){                
                getProjects();
            });
            
            // Get Projects
            function getProjects (){
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: 'json',
                    headers: getAuth()
                })
                .done(function(res) {
                    print("Projects", res);
                    var options = $('#options');                    
                    var s = $('<select id="selectProjects" />');
                    var pro = res.value;
                    for(var val in pro) {
                        $("<option />", {value: pro[val].name, text: pro[val].name}).appendTo(s);
                    }
                    options.append(s);
                    options.append('<button onclick="getTasks()">Get Tasks</button>');
                })
                .fail(function(err) {
                    print("Projects ERROR", err);
                });
            }
            
            // Get Tasks
            function getTasks(){
                print("Loading...", {});
                $.ajax({
                    type: "GET",
                    url: urlBase + $('#selectProjects').val() +'/'+urlWorkItems,
                    dataType: 'json',
                    headers: getAuth()
                })
                .done(function(res) {
                    print("Work Items", res);                    
                })
                .fail(function(err) {
                    print("Work Items ERROR", err);
                });
            }
        </script>
    </body>
</html>
